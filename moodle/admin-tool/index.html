<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="Lukas Biermann, Nina Herrmann, Wladislaw Iwanzow, Dennis Meis, Jonathan Neugebauer">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Admin Tool - sciebo@Learnweb</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">sciebo@Learnweb</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">ownCloud <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../owncloud/technische-umsetzung/">Technische Umsetzung</a>
</li>

                        
                            
<li >
    <a href="../../owncloud/benutzung/">Benutzung</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Moodle <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Technische Umsetzung</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../software-architektur/">Software Architektur</a>
</li>

        
            
<li class="active">
    <a href="./">Admin Tool</a>
</li>

        
            
<li >
    <a href="../repository/">Repository</a>
</li>

        
            
<li >
    <a href="../activity/">Collaborative Folders</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../benutzung/">Benutzung</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Suchen
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../software-architektur/">
                            <i class="fa fa-arrow-left"></i> Zurück
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../repository/">
                            Weiter <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/pssl16">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#admin-tool-oauth2sciebo">Admin Tool: oauth2sciebo</a></li>
        
            <li class="second-level"><a href="#zweck-des-plugins">Zweck des Plugins</a></li>
            
        
            <li class="second-level"><a href="#vorgegebene-schnittstelle">Vorgegebene Schnittstelle</a></li>
            
        
            <li class="second-level"><a href="#implementierung-der-vorgegebenen-schnittstelle">Implementierung der vorgegebenen Schnittstelle</a></li>
            
                <li class="third-level"><a href="#eingabemaske">Eingabemaske</a></li>
            
        
            <li class="second-level"><a href="#oauth-20-client">OAuth 2.0 Client</a></li>
            
        
            <li class="second-level"><a href="#tests-und-ci">Tests und CI</a></li>
            
        
    
        <li class="first-level "><a href="#anderungen-an-core-bibliotheken">Änderungen an Core Bibliotheken</a></li>
        
            <li class="second-level"><a href="#anpassung-des-webdav-clients">Anpassung des WebDAV Clients</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="admin-tool-oauth2sciebo">Admin Tool: <code>oauth2sciebo</code></h1>
<h2 id="zweck-des-plugins">Zweck des Plugins</h2>
<p>Wie bereits im Kapitel <a href="../software-architektur/">Software Architektur</a> angeschnitten, ist der Hauptzweck dieses Plugins
die Schnittstelle zu Sciebo bzw. ownCloud bereitzustellen. Zu diesem Zweck wird die im Projekt implementierte ownCloud 
App <a href="../../owncloud/technische-umsetzung/">OAuth2</a> mit Hilfe eines OAuth 2.0 Clients über die WebDAV Schnittstelle angesprochen.
Gleichzeitig kann dieses Plugin auch für ähnliche externe Datenquellen verwendet werden, sofern diese über die nötigen
OAuth 2.0 und WebDAV Schnittstellen verfügen.</p>
<p>Im Wesentlichen implementiert dieses Plugin folgende <a href="../software-architektur/">Integrationsszenarien</a>:</p>
<ul>
<li><strong>Beispiel 1:</strong> ...</li>
<li><strong>Beispiel 2:</strong> ...</li>
</ul>
<div class="alert alert-danger">
  <strong>TODO:</strong> Integrationsszenarien definieren und hier einfügen.
</div>

<h2 id="vorgegebene-schnittstelle">Vorgegebene Schnittstelle</h2>
<p>Für Admin Tools ist in moodle lediglich eine schwach definierte Schnittstelle gegeben. Wie in jedem anderen moodle Plugin 
auch, müssen zunächst einige Standartdateien implementiert werden: </p>
<ul>
<li><strong><code>version.php</code>:</strong> Beschreibt die Versionsnummer des Plugins, die benötigte moodle Version und Abhängigkeiten des Plugins.</li>
<li><strong><code>access.php</code>:</strong> Legt die Berechtigungen für definierte Aktionen innerhalb des Plugins anhand von Nutzerrollen fest.</li>
<li><strong><code>tool_oauth2sciebo.php</code>:</strong> Beinhaltet Sprachstrings für unterschiedliche Regionen und Sprachen, sodass definierte Strings,
abhängig von der jeweiligen Sprache, dynamisch angezeigt werden können.</li>
</ul>
<p>Zusätzlich zu den allgemeinen Plugindateien, sollte unser Admin Tool auch mindestens noch eine Datei namens <code>settings.php</code>
beinhalten. Diese umfasst alle Einstellungen, die für das Admin Tool geltend dem Administrator der moodle Instanz zur 
Verfügung gestellt werden sollen. Nach der Eingabe, wird diese Konfiguration moodle-intern in dem sogenannten <a href="https://docs.moodle.org/dev/Admin_settings">Admin Tree</a>
gespeichert. Aus dieser Baumstruktur können anschließend benötigte Einstellungen beschafft werden.</p>
<p>Insgesamt ergibt sich folgende Struktur von Ordnern und Dateien, die mindestens für die Implementierung des von uns gebrauchten
Admin Tools notwendig ist:</p>
<div class="alert alert-danger">
  <strong>TODO:</strong> Grafik für Ordnerstruktur einfügen.
</div>

<h2 id="implementierung-der-vorgegebenen-schnittstelle">Implementierung der vorgegebenen Schnittstelle</h2>
<h3 id="eingabemaske">Eingabemaske</h3>
<p>Um die OAuth 2.0 und WebDAV Clients erfolgreich zum Zugriff auf eine entsprechende Sciebo bzw. ownCloud Instanz zu befähigen,
müssen diese zunächst mit Hilfe benötigter Eingabedaten konfiguriert werden. Diese sollen zentral im Admin Tool eingegeben und
gespeichert werden können, um sie anschließend von anderen Plugins aus nutzen zu können. Dies ist einer der Gegensätze zu
ähnlichen, vor Allem repository Plugins, welche die benötigte Daten auf Plugin-Ebene abfragen und benutzen.</p>
<p>Eine solche Eingabemaske kann im Rahmen der <code>settings</code> definiert werden. Zu diesem Zweck muss zunächst ein neues Objekt vom Typ <code>admin_settingpage</code>
innerhalb der <code>settings.php</code> Datei erstellt werden. Dieses Objekt umfasst eine Gruppe von Einstellungen, welche, sobald hinzugefügt,
in dem Admin Tree eingeordnet und gespeichert werden. Die zugehörige Klasse befindet sich in Funktionsbibliothek
<a href="https://github.com/moodle/moodle/blob/master/lib/adminlib.php"><code>adminlib.php</code></a>, welche Teil des moodle Cores ist. Beim 
Aufruf des Konstruktors müssen Name des Plugins, welcher später dazu verwendet wird die Einstellung im Admin Tree wiederzufinden,
und der Anzeigename für die Einstellungsseite übergeben werden. </p>
<p>Um den OAuth 2.0 Protokollablauf zu ermöglichen, müssen folgende Daten im Vorfeld erfasst werden:</p>
<ul>
<li><strong><code>Client ID</code>:</strong> wird in ownCloud generiert und dient der Identifizierung eines regstrierten Clients.</li>
<li><strong><code>Secret</code>:</strong> wird ebenfalls in ownCloud generiert und zur Authentifizierung verwendet.</li>
</ul>
<p>Beide Datensätze sind Strings und daher eignet sich für beide ein Textfeld zur Eingabe.</p>
<p>Zur Nutzung des WebDAV Clients werden darüber hinaus folgende Daten benötigt:</p>
<ul>
<li><strong><code>Server Addresse</code>:</strong> Url über die der ownCloud Server erreicht werden kann.</li>
<li><strong><code>Server Pfad</code>:</strong> der angehangene Pfad, über den die WebDAV Schnittstelle erreicht werden kann.</li>
<li><strong><code>Port</code>:</strong> Port des WebDAV-Servers.</li>
<li><strong><code>SSL-Verschlüsselung</code>:</strong> Wahl zwischen HTTP und HTTPS.</li>
<li><strong><code>Authentifizierung</code>:</strong> Wahl zwischen Basic und Bearer Authentifizierung.  </li>
</ul>
<p>Während Server Adresse, Pfad und Port mittels eines Textfeldes abgefragt werden können, sollten die anderen Optionen mit Hilfe
einer Auswahl aus den angebotenen Möglicheiten erfragt werden können.</p>
<p>Um nun die Eingabeeinstellungen dem Admin Tree anzuhängen, muss jedes vorgesehene Eingabefeld der <code>admin_settingpage</code> 
mittels der Methode <code>add</code> hinzugefügt werden. Der dafür notwendige Code sieht wie folgt aus:</p>
<pre><code class="php">&lt;?php

$temp = new admin_settingpage('oauth2sciebo', new lang_string('pluginname', 'tool_oauth2sciebo'));
$temp-&gt;add(new admin_setting_heading('coursebank_proxy_head',
        get_string('configplugin', 'tool_oauth2sciebo'),
        ''
        ));
$temp-&gt;add(new admin_setting_configtext('tool_oauth2sciebo/clientid',
        get_string('clientid', 'tool_oauth2sciebo'),
        '', ''
        ));
$temp-&gt;add(new admin_setting_configtext('tool_oauth2sciebo/secret',
        get_string('secret', 'tool_oauth2sciebo'),
        '', ''
        ));
$temp-&gt;add(new admin_setting_configtext('tool_oauth2sciebo/server',
        get_string('server', 'tool_oauth2sciebo'),
        '', ''
    ));
$temp-&gt;add(new admin_setting_configtext('tool_oauth2sciebo/path',
        get_string('path', 'tool_oauth2sciebo'),
        '', ''
    ));
$temp-&gt;add(new admin_setting_configtext('tool_oauth2sciebo/port',
        get_string('port', 'tool_oauth2sciebo'),
        '', ''
    ));
$temp-&gt;add(new admin_setting_configselect('tool_oauth2sciebo/auth',
        get_string('auth', 'tool_oauth2sciebo'),
        '', '', array('basic' =&gt; 'Basic', 'bearer' =&gt; 'Bearer')
    ));

$ADMIN-&gt;add('authsettings', $temp);
</code></pre>

<p>Hierbei sind die Klassen <code>admin_setting_heading</code>, <code>admin_configtext</code> und <code>admin_configselect</code> ebenfalls Teil der <code>adminlib.php</code>
und die Überschrift der Einstellungen, eine Eingabetextfeld und eine Eingabeauswahl. Beim Erstellen eines Objektes der Klassen 
<code>admin_configtext</code> und <code>admin_configselect</code> müssen neben dem einzigartigen Einstellungsnamen Anzeigename, Beschreibung und Standartwert
übergeben werden, wobei bei letzterem die Auswahlmöglichkeiten angegeben werden müssen.</p>
<p>Sobald alle nötigen Optionen erstellt worden und der <code>admin_settingpage</code> hinzugefügt worden sind, muss diese dem Globalen
<code>ADMIN</code> Objekt hinzugefügt werden. Dabei wird auch die Stelle übergeben, an der die Einstellungen in moodle gefunden werden
können. Im Fall des hier implementierten Admin Tools, werden die Einstellungen unter den Authentifizierungs-Optionen
gelistet. Damit ist die Erstellung der Eingabemaske abgeschlossen.</p>
<h2 id="oauth-20-client">OAuth 2.0 Client</h2>
<h2 id="tests-und-ci">Tests und CI</h2>
<h1 id="anderungen-an-core-bibliotheken">Änderungen an Core Bibliotheken</h1>
<h2 id="anpassung-des-webdav-clients">Anpassung des WebDAV Clients</h2></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Copyright &copy; 2017 PSSL16<br></small>
        
        <small>Dokumentation erzeugt mit <a href="http://www.mkdocs.org/">MkDocs</a>.</small></p>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Schließen</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Suchen</h4>
                </div>
                <div class="modal-body">
                    <p>
                        Hier können Sie die Dokumentation durchsuchen. Geben Sie Ihre Suchbegriffe unten ein.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Suchen..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
