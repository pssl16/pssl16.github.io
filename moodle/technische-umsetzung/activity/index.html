<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="Lukas Biermann, Nina Herrmann, Wladislaw Iwanzow, Dennis Meis, Jonathan Neugebauer">  
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title>Collaborative Folders - sciebo@Learnweb</title>

    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">sciebo@Learnweb</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">ownCloud <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Technische Umsetzung</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../owncloud/technische-umsetzung/oauth2/">OAuth 2.0</a>
</li>

        
            
<li >
    <a href="../../../owncloud/technische-umsetzung/softwarearchitektur/">Softwarearchitektur</a>
</li>

        
            
<li >
    <a href="../../../owncloud/technische-umsetzung/oauth2-app/">OAuth 2.0 App</a>
</li>

        
            
<li >
    <a href="../../../owncloud/technische-umsetzung/core-anpassungen/">Core Anpassungen</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../../owncloud/benutzung/">Benutzung</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Moodle <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Technische Umsetzung</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../softwarearchitektur/">Softwarearchitektur</a>
</li>

        
            
<li >
    <a href="../admin-tool/">Admin Tool</a>
</li>

        
            
<li >
    <a href="../repository/">Repository</a>
</li>

        
            
<li class="active">
    <a href="./">Collaborative Folders</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../benutzung/">Benutzung</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Suchen
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../repository/">
                            <i class="fa fa-arrow-left"></i> Zurück
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../benutzung/">
                            Weiter <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/pssl16">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#zweck">Zweck</a></li>
        
    
        <li class="first-level "><a href="#speicherort-und-zugriff">Speicherort und Zugriff</a></li>
        
    
        <li class="first-level "><a href="#vorgegebene-schnittstelle">Vorgegebene Schnittstelle</a></li>
        
    
        <li class="first-level "><a href="#implementierung">Implementierung</a></li>
        
            <li class="second-level"><a href="#anmelden-des-technischen-nutzers">Anmelden des technischen Nutzers</a></li>
            
        
            <li class="second-level"><a href="#hinzufugen-einer-instanz">Hinzufügen einer Instanz</a></li>
            
        
            <li class="second-level"><a href="#erstellen-von-ordnern">Erstellen von Ordnern</a></li>
            
        
            <li class="second-level"><a href="#ansicht-der-bestehenden-instanzen">Ansicht der bestehenden Instanzen</a></li>
            
                <li class="third-level"><a href="#sicht-der-studierenden">Sicht der Studierenden</a></li>
            
                <li class="third-level"><a href="#sicht-der-lehrenden">Sicht der Lehrenden</a></li>
            
        
    
        <li class="first-level "><a href="#tests-und-continuous-integration">Tests und Continuous Integration</a></li>
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<div><img alt="" align=right src="../../images/icon_mod_collaborativefolders.svg" width=20% position=right>
<h1> Aktivität: <span class=code>collaborativefolders</span></h1>
</div>

<h2 id="zweck">Zweck</h2>
<p>Das Aktivitäts Modul <strong>Collaborative Folders</strong> soll Lehrenden die Möglichkeit geben, für Studierende oder Gruppen von Studierenden Ordner für kollaboratives Arbeiten zu erstellen.
Sowohl die Autorisierung und Authentifizierung, als auch der Zugriff auf ownCloud Schnittstellen erfolgen über das <code>oauth2owncloud</code> <a href="../admin-tool/">Admin Tool</a>. Somit implementiert dieses Plugin das folgende Integrationsszenario:</p>
<blockquote>
<p>Als <strong>Lehrender</strong> möchte ich Studierenden oder Gruppen von Studierenden Ordner für kollaboratives Arbeiten bereitstellen.</p>
</blockquote>
<p>Dabei soll der Lehrende beliebig viele Instanzen der Aktivität erstellen können bei denen er jeweils selbst entscheiden kann, ob er Ordner für einzelne Gruppen freigibt und ob er selbst auf die erstellten kollaborativen Ordner Zugriff haben möchte. Zusätzlich sollen die Teilnehmer der Aktivität jeweils selbst über den Namen des Ordners und dessen Freigabe für sie entscheiden können.</p>
<p>Mit dieser Aktivität kann der Lehrende Kursteilnehmer ermutigen kollaborativ zu arbeiten. Zusätzlich hat er die Option die laufende Arbeit zu betreuen, indem er sich selbst Zugriff auf die Ordner gewährt. Somit haben kursteilnehmer insgesamt weniger Organisationsaufwand und werden bei ihrer Gruppenarbeit unterstützt.</p>
<h2 id="speicherort-und-zugriff">Speicherort und Zugriff</h2>
<p>Der zur Lagerung der erstellten kollaborativen Ordner genutzte Speicherplatz sollte neutral und unabhängig von einzelnen, Nutzer-spezifischen ownCloud Instanzen. Diese Vorüberlegung geht aus den folgenden Gründen hervor:</p>
<ul>
<li>Der <strong>Lehrende</strong> muss nicht zwingend Zugriff auf die Ordner haben.<ul>
<li>Seine persönliche Instanz ist damit ungeeignet.</li>
</ul>
</li>
<li>Für den benötigten Speicherplatz könnte eine persönliche Instanz nicht ausreichen.<ul>
<li><strong>Kapazitäten</strong> sind häufig begrenzt.</li>
</ul>
</li>
<li>Die gespeicherten Daten sollen <strong>langfristig</strong> erhalten bleiben.<ul>
<li>Dies ist besonders wichtig, da die Ordner, obgleich mit den Nutzern geteilt, von dem Zustand des <strong>geteilten Ordners</strong> abhängig sind.</li>
</ul>
</li>
</ul>
<p>Daraus ergibt sich, dass für die Speicherung der kollaborativen Ordner zunächst ein neutraler Speicherort angegeben muss. Dieser Speicherort muss sich auf dem selben ownCloud Server befinden um das Teilen von Inhalten zwischen diesem Speicherort und den Ordnernutzern zu gewährleisten. Dabei werden die nötigen Server-Angaben dem OAuth 2.0 ownCloud Client entnommen, welcher auch für Nutzer-seitige Zugriffe verantwortlich ist. </p>
<p>Bevor von einem Lehrenden ein kollaborativer Ordner erstellt werden kann, muss der Administrator zunächst für das Plugin global eben diesen neutralen Speicherort in Form eines Nutzer-Accounts hinterlegen. In dessen Namen werden anschließend alle kollaborativen Ordner erstellt und mit den entsprechenden Nutzern geteilt. Im Folgenden wird dieser Nutzer-Account als <strong>technischer Nuter</strong> bezeichnet.</p>
<p>Um nun auf die erstellen Ordner zugreifen zu können, müssen diese von dem technischen Nutzer mit den Personen geteilt werden, welche zum Zugriff zuvor berechtigt worden sind. Dabei kann es sich um alle Kursteilnehmer oder nur spezifische Gruppen einschließlch oder ausschließlich dem Lehrenden handeln. Einerseits bringt dies den Vorteil, dass kein Speicherplatz in den persönlichen ownCloud Instanzen für die Gruppenordner gebraucht wird; andererseits birgt es aber auch den Nachteil, dass der geteilte Ordner gelöscht werden kann, ohne dass die Nutzer jeweils eine Kopie den gespeicherten Daten erhalten. Daher ist es notwendig, dass der technische Nutzer die Daten über einen längeren Zeitraum hinweg sichern kann.</p>
<h2 id="vorgegebene-schnittstelle">Vorgegebene Schnittstelle</h2>
<p>Das Integrationsszenario wurde im Rahmen eines <a href="https://docs.moodle.org/dev/Activity_modules" title="Activity Modules">Activity Modules</a> in Moodle umgesetzt. Instanzen solcher Plugins können in Kursen von einem Lehrenden beliebig oft hinzugefügt werden und stellen für die Studierenden eine Interaktion innerhalb eines Kurses dar.</p>
<p>Ähnlich wie bei anderen Moodle Plugins, muss zunächst eine mindestens erforderliche Schnittstelle inerhalb der vorgegebenen Ordner und Dateien implementiert werden, welche das Plugin mit dem Moodle Core verbindet. Die für <code>collaborativefolders</code> relevantesten Dateien sind die folgenden:</p>
<ul>
<li><strong><code>mod_form.php</code>:</strong> Definiert ein Formular, dessen Eingaben vor dem Erstellen eines Ordners bekannt sein müssen.<ul>
<li>Name der Aktivität, Zugriffberechtigungen (<strong>Lehrender</strong> und <strong>Gruppen</strong>), <a href="https://docs.moodle.org/32/en/Groups#Group_modes">Gruppenmodus</a></li>
</ul>
</li>
<li><strong><code>settings.php</code>:</strong> Beinhaltet eine Einstellungsseite für globale Konfigurationen von <code>collaborativefolders</code>.<ul>
<li>Wird verwendet um den technischen Nutzer zu verwalten.</li>
</ul>
</li>
<li><strong><code>lib.php</code>:</strong> Bietet eine Schnittstelle zum Erstellen, Ändern und Löschen von Instanzen der Aktivität.<ul>
<li>Definiert, was im Fall einer der Operationen getan werden muss.</li>
</ul>
</li>
<li><strong><code>view.php</code>:</strong> Konstruiert die Ansichtsseite der Aktivität abhängig von dem Status der Aktivität und der Berechtigungen des aktuellen Nutzers.</li>
</ul>
<p>Sonstige Standarddateien werden auch in der Dokumentation zum <a href="../admin-tool/#vorgegebene-schnittstelle">Admin Tool</a> beschrieben.</p>
<h2 id="implementierung">Implementierung</h2>
<p>Da die Implementierung der vorgegebenen Schnittstelle von Zugriffen auf ownCloud und zusätzlichen Hilfsklassen abhängt, umfasst sie vorgegebenen und nicht-vorgegebenen Schnittstellen und Inhalte gemeinsam. </p>
<h3 id="anmelden-des-technischen-nutzers">Anmelden des technischen Nutzers</h3>
<p>Der Administrator der Moodle Seite kann in der Seiten-Administration einen technischen Nutzer hinzufügen. Über <code>Website-Administration ► Plugins ► Aktivitäten ► collaborativefolders</code> kommt er zu den entsprechenden Einstellungen. An dieser Stelle kann er mittels eines Login-Links einen technischen Nutzer authentifizieren und autorisieren. Damit wird der technische Nutzer mit allen Instanzen der <code>collaborativefolders</code> Aktivität <a href="../activity/#speicherort-und-zugriff">verknüpft</a>. Zwar sind spätere Änderungen des technischen Nutzers durch einen Logout möglich, jedoch ist dies nicht empfohlen und mit einer Warnmeldung versehen, da Kompilierungs-Probleme mit bestehenden Instanzen entstehen würden. Für den Fall, dass im Moment des Logins zum Bespiel ein falscher Nutzer in ownCloud authentifiziert ist, wird der Logout des technischen Nutzer dennoch bereitgestellt. Das folgende Szenario begründet die Entscheidung:</p>
<blockquote>
<p>Der Seiten Administrator will den technischen Nutzer einloggen, ist aber noch mit seinem eigenen ownCloud Account oder dem Administrator Account in ownCloud authentifiziert. Er bemerkt nicht, dass er mit dem falschen Account eingeloggt ist und autorisiert das Plugin. Als er seinen Fehler bemerkt, möchte er den technischen Nutzer so schnell wie möglich ändern, obwohl bestehende Instanzen neu erstellt werden müssen.</p>
</blockquote>
<p>Die Verwaltung des Login-Status übernimmt intern der OAuth 2.0 ownCloud Client, welcher innerhalb der <code>settings.php</code> in die Einstellungsseite des Plugins eingebettet ist. Abhängig von dem Login-Status des technischen Nutzers werden durch den Client verschiedene Operationen durchgeführt und dem Administrator dementsprechend verschiedene Möglichkeiten angeboten. Das folgende Codebeispiel zeigt abstrahiert, wie der Client agiert.</p>
<pre><code class="php">if ($logout === true) {

    set_config('token', null, 'mod_collaborativefolders');
    print_login();

} else {

    if ($owncloud-&gt;check_login('mod_collaborativefolders')) {

            print_logout();


    } else {

            set_config('token', null, 'mod_collaborativefolders');
            print_login();

    }
}
</code></pre>

<p>Die Variable <code>$owncloud</code> stellt in dem Code den Client dar. Falls zuvor der Logout-Link betätigt worden ist, enthält die Variable <code>$logout</code> den Wert <code>true</code>. Die folgenden Szenarien stellt das Codebeispiel dar:</p>
<ol>
<li>
<p><strong>Der technische Nutzer ist nicht angemeldet.</strong></p>
<p>Falls der technische Nutzer noch nicht angemeldet worden ist, wurde für ihn auch noch kein <a href="../admin-tool/#speicherung-nutzer-spezifischer-access-tokens">Plugin-spezifisches</a> Access Token hinterlegt. Wenn nun also der Client prüft, ob das Access Token noch gültig, ist, wird er kein Token vorfinden und daher <code>false</code> zurückgeben. Folgerichtig wird ein Login-Link für den technischen Nutzer angezeigt.</p>
</li>
<li>
<p><strong>Der technische Nutzer ist angemeldet.</strong></p>
<p>Das Token des technischen Nutzers wird in Plugin-spezifischen Einstellungen gespeichert, da es zu keinem persönlichen Nutzer, sondern zum Plugin gehört. Dieses Szenario wird sowohl in dem Fall, dass das bereits erhaltene Access Token gültig ist, als auch beim Erhalt eines gültigen Authorization Codes aufgerufen. Wenn der Client das aktuelle Access Token also für gültig erklärt, gilt der technische Nutzer als eingeloggt und der Administrator darf ihn bei Bedarf ausloggen.</p>
</li>
<li>
<p><strong>Der technische Nutzer wird ausgeloggt.</strong></p>
<p>Es wird registriert, dass der Logout-Link betätigt wurde (<code>$logout === true</code>). Das aktuelle Access Token des technischen Nutzers wird daraufhin in den Einstellungen gelöscht und dem Administrator erneut ein Login-Link angezeigt. Zusätzlich wird ein Event ausgelöst, welches den Logout dokumentiert.</p>
</li>
</ol>
<h3 id="hinzufugen-einer-instanz">Hinzufügen einer Instanz</h3>
<p>Die Schnittstelle in Moodle für das Einstellungsformular ist sehr ausführlich. Den Standardeinstellungen haben wurde nur eine Checkbox hinzugefügt die bestimmt, ob der Lehrende Zugriff auf die Ordner hat.
Außerdem benutzen wird den Moodle internen <em>group_mode</em>. Dieser ermöglicht es Gruppen separat zu bearbeiten. Wie für separate Gruppen Ordner erstellt werden  wird unter anderem im nächsten Abschnitt erklärt, der sich mit dem Erstellen von Ordnern auseinander setzt. Falls sie mehr Informationen zu der <code>mod_form.php</code> in Moodle benötigen besuchen sie <a href="https://docs.moodle.org/dev/Activity_modules#mod_form.php">diese Seite</a>.</p>
<h3 id="erstellen-von-ordnern">Erstellen von Ordnern</h3>
<p>Zum Erstellen von Ordnern wurde ein Observer implementiert, der aufgerufen wird wenn eine Instanz der Aktivität <code>collaborativefolders</code> erstellt wird.
In <code>collaborativefolders/db/events.php</code> können in einem Array alle Observer registriert werden und werden dann von Moodle verwaltet.</p>
<pre><code class="php">$observers = array(
        array(
                // Zuerst wird das Event, dass beobachtet werden soll festgelegt.
                'eventname'   =&gt; '\core\event\course_module_created',
                // Als nächstes wird der Observer festgelegt.
                'callback'    =&gt; 'mod_collaborativefolders\observer::collaborativefolders_created',
                'internal'  =&gt; false,
                'priority'  =&gt; 1000
        )

);
</code></pre>

<p>Somit wird, sobald das Event <code>course_module_created</code> erzeugt wird, der Observer aufgerufen. Es gibt zwei Hauptgründe warum dies erforderlich ist. Zunächst benötigt man für das Erstellen der Ordner die <code>course_module_id</code>. Diese ist nur verfügbar wenn die Instanz schon erstellt wurde, somit kann nicht die Schnittstelle der <code>collaborativefolders/lib.php</code> <code>add_instance()</code> genutzt werden. Desweiteren ruft unser Observer einen CronJob auf. Dieser sorgt dafür, dass Ordner zeitlich verzögert erstellt werden, wodurch der Server nicht kurzzeitig überlastet wird. Falls Ordner für große Kurse mit über 50 Gruppen erstellt werden sollen könnte es hier sonst zu Schwierigkeiten kommen.
Beim Erstellen müssen zwei unterschiedliche Szenarien betrachtet werden:</p>
<p>Im ersten Szenario wird ein Ordner für alle Studierenden eines Kurses erstellt.
Die Anforderung an das Modul ist es also einen Ordner in dem gespeicherten Account zu erstellen, der eindeutig identifizierbar ist. Dies ist gesichert indem die Ordner nach der <code>course_module_id</code> benannt werden. Diese ist einzigartig für jede Aktivität, die in Moodle erzeugt wird. So kann es, soweit manuell
keine Ordner erstellt werden, zu keinen Synchronisationskonflikten kommen.</p>
<pre><code class="php">$paths = array();
            $paths['cmid'] = $cmid;

            list ($course, $cm) = get_course_and_cm_from_cmid($cmid, 'collaborativefolders');
</code></pre>

<p>Im zweiten Szenario sollen Ordner für Gruppen innerhalb eines Kurses erstellt werden.
Auch hier müssen eindeutig identifizierbare Ordner erstellt werden. Deswegen wird ein Überordner erstellt mit der <code>course_module_id</code>. In diesem Ordner wird nun zu jeder Gruppe ein Unterordner erstellt.</p>
<pre><code class="php">if (groups_get_activity_groupmode($cm) != 0) {
    $grid = $cm-&gt;groupingid;
    $groups = groups_get_all_groups($course-&gt;id, 0, $grid);

    foreach ($groups as $group) {
        $path = $cmid . '/' . $group-&gt;id;
        $paths[$group-&gt;id] = $path;
    }
}
</code></pre>

<p>Zu diesem Zweck wird in der Variable <code>$path</code> die einem Cronjob übergeben wird nicht nur die <code>course_module_id</code> gespeichert, sondern auch für jede <code>$groupid</code> ein Feld.
Der Cronjob, der nun die Ordner erstellt, kann anhand der Einträge im Array erkennen wie viele und welche Ordner er erstellen muss.</p>
<p>Der Cronjob findet sich in <code>collaborativefolders/classes/task/collaborativefolders_create.php</code>. Er erbt von der abstrakten Klasse <code>\core\task\adhoc_task</code>.
Dieser liest aus den Daten, die er übergeben bekommt, alle Ordner aus, die erstellt werden müssen.</p>
<pre><code class="php">foreach ($data as $key =&gt; $value) {
            $code = $oc-&gt;handle_folder('make', $value);
            if ($code == false) {
                throw new \coding_exception('Folder ' . $value . ' not created.');
            } else {
                mtrace('Folder: ' . $value . ', Code: ' . $code);
                if (($code != 201) &amp;&amp; ($code != 405)) {
                    throw new \coding_exception('Folder ' . $value . ' not created.');
                }
            }
        }
</code></pre>

<h3 id="ansicht-der-bestehenden-instanzen">Ansicht der bestehenden Instanzen</h3>
<p>Nun, da der Lehrende alle notwendigen Einstellungen tätigen konnte, musste die Ansicht der Kursteilnehmer auf die Aktivität mit allen notwendigen Funktionalitäten implementiert werden. Dies beinhaltet die individuelle Namensvergabe für Ordner in ownCloud und das Hinzufügen dieser Ordner zur eigenen Instanz.
Lehrende sollen entweder eine Übersicht aller Ordner haben, oder keinen Zugriff auf die Ordner haben. Alle Funktionalitäten sind in der <code>view.php</code> implementiert.</p>
<h4 id="sicht-der-studierenden">Sicht der Studierenden</h4>
<p>Für Studierende wird zunächst überprüft, ob der <code>group_mode</code> aktiviert ist. Wenn dies der Fall ist, wird an den Pfad, über den später der Ordner gefunden werden soll, die GruppenID angefügt. Moodle hat hierfür intern eine Methode <code>groups_get_activity_group()</code> die zu einer Instanz der Aktivität angibt in welcher Gruppe der Studierende ist.
Die <code>view.php</code> wird zu verschiedenen Zwecken aufgerufen die behandelt werden müssen.</p>
<ol>
<li>
<p><strong>Der Ordnername wird erstmals gespeichert</strong></p>
<p>Der Ordnername wird in den moodle <code>user_preferences</code> gespeichert. Diese werden für jeden Nutzer einzeln gespeichert und können beliebig geändert oder gelöscht werden. Die Eingabemaske für einen Ordnernamen wird nur angezeigt wenn bis jetzt kein Name gesetzt wurde oder der Nutzer explizit ausgewählt hat, das der Name zurückgesetzt werden soll.</p>
</li>
<li>
<p><strong>Der Name des Ordners wird geändert</strong></p>
<p>Wenn der Name des Ordners zurückgesetzt wird, wird ein URL Parameter <em>reset=1</em> an die URL übergeben. In diesem Fall wird dem Kursteilnehmer eine Eingabemaske angezeigt. Diese ist als eigene Klasse in dem Ordner <code>collaborativefolders/classes</code> implementiert. Sie erbt von der abstrakten Klasse <code>moodleform</code>. Es muss nun sichergestellt werden das vergebene Namen kompatibel mit ownCloud sind. Moodle unterstützt die zugelassenen Eingaben durch Begrenzung nach <em>Form Element</em> Regeln.</p>
<p><code>$mform-&gt;addRule('namefield', get_string('err_alphanumeric', 'form'), 'alphanumeric', null, 'client');</code></p>
<p>Diese Regel verbietet andere Eingaben zu speichern, als Buchstaben und Zahlen.</p>
</li>
<li>
<p><strong>Der Nutzer loggt sich aus seinem aktuell gespeichertem Account aus</strong>
    Der Nutzer muss mit Hilfe des <code>oauth2owncloud</code> admin_tools ausgeloggt werden, und der <code>access token</code> wird auf null gesetzt.</p>
<p><code>$ocs-&gt;owncloud-&gt;log_out();
set_user_preference('oC_token', null);</code></p>
</li>
<li>
<p><strong>Kursteilnehmer rufen die Seite auf, obwohl die Ordner noch nicht vom CronJob erstellt wurden.</strong></p>
<p>Für jeden Ordner wird überprüft, ob der Ordner schon erstellt wurde: Zur Information wird dem Nutzer angezeigt, dass die Ordner noch nicht erstellt wurden.</p>
<p><code>$content = json_decode($element-&gt;customdata);
$cmidoftask = $content-&gt;cmid;
if ($id == $cmidoftask) {
    $created = false;
}</code></p>
</li>
</ol>
<h4 id="sicht-der-lehrenden">Sicht der Lehrenden</h4>
<p>Falls der Lehrende sich selbst keinen Zugriff gewährt hat, sieht er den Ordner auch nicht wenn er in einer Gruppe eingeschrieben ist. Hat der Lehrende Zugriff auf die Ordner, so sieht er eine tabellarische Auflistung aller bestehenden Ordner. Zusätzlich kann er genau wie Studierende seinen ownCloud Account ändern, den Namen des Ordners ändern und Ordner per Klick der eigenen Instanz hinzufügen. In dem Fall, dass Gruppenordner erstellt wurden, wird dem Lehrenden der Überordner aller Gruppenordner hinzugefügt.</p>
<h2 id="tests-und-continuous-integration">Tests und Continuous Integration</h2></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Copyright &copy; 2017 PSSL16<br></small>
        
        <small>Dokumentation erzeugt mit <a href="http://www.mkdocs.org/">MkDocs</a>.</small></p>
    </footer>

    <script src="../../../js/jquery-1.10.2.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../../..';
    </script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Schließen</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Suchen</h4>
                </div>
                <div class="modal-body">
                    <p>
                        Hier können Sie die Dokumentation durchsuchen. Geben Sie Ihre Suchbegriffe unten ein.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Suchen..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
