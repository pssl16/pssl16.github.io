<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="Lukas Biermann, Nina Herrmann, Wladislaw Iwanzow, Dennis Meis, Jonathan Neugebauer">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>ownCloud - sciebo@Learnweb</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">sciebo@Learnweb</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">ownCloud</a>
                    </li>
                
                
                
                    <li >
                        <a href="../moodle/">Moodle</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Suchen
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Zurück
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../moodle/">
                            Weiter <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/pssl16">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#owncloud">ownCloud</a></li>
        
            <li class="second-level"><a href="#technische-umsetzung">Technische Umsetzung</a></li>
            
                <li class="third-level"><a href="#implementierung-der-oauth2-app">Implementierung der oauth2 App</a></li>
            
                <li class="third-level"><a href="#anpassung-der-dav-app">Anpassung der dav App</a></li>
            
        
            <li class="second-level"><a href="#benutzung">Benutzung</a></li>
            
                <li class="third-level"><a href="#installation">Installation</a></li>
            
                <li class="third-level"><a href="#clientregistrierung">Clientregistrierung</a></li>
            
                <li class="third-level"><a href="#authorization-code-flow">Authorization Code Flow</a></li>
            
                <li class="third-level"><a href="#angepasste-webdav-schnittstelle">Angepasste WebDAV Schnittstelle</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="owncloud">ownCloud</h1>
<p>Um auf Dateien in ownCloud zuzugreifen, wird standardmäßig <a href="https://doc.owncloud.org/server/latest/user_manual/files/access_webdav.html">eine WebDAV Schnittstelle angeboten</a>. Da diese jedoch nur über <a href="https://tools.ietf.org/html/rfc7617">Basic Authentication</a> ansprechbar ist, musste sie um das <a href="https://oauth.net/2/">OAuth 2.0 Protokoll</a> erweitert werden.</p>
<h2 id="technische-umsetzung">Technische Umsetzung</h2>
<p>Da man möglichst keine neue Schnittstelle implementieren wollte, war es das Ziel, die bestehende WebDAV Schnittstelle um OAuth 2.0 zu erweitern. Die WebDAV Schnittstelle ist als <a href="https://doc.owncloud.org/server/latest/developer_manual/app/">ownCloud App</a> realisiert worden und nutzt die <a href="http://sabre.io/">sabre/dav</a> Bibliothek. Auf der anderen Seite musste das OAuth 2.0 Protokoll mit seinen Schnittstellen bereitgestellt werden, um die Authentifizierung in der WebDAV App um OAuth 2.0 zu erweitern zu können. Dafür wurde eine weitere ownCloud App implementiert.</p>
<h3 id="implementierung-der-oauth2-app">Implementierung der <code>oauth2</code> App</h3>
<p>In der App sollte der häufig für Webapplikationen eingesetzte <a href="https://tools.ietf.org/html/rfc6749#section-4.1">Authorization Code Flow</a> implementiert werden. Dazu mussten folgende User Stories umgesetzt werden:</p>
<ul>
<li><strong>Clientregistrierung:</strong> Als ownCloud-Administrator möchte ich Clients in den Administrator-Einstellungen hinzufügen und löschen können, um die Kontrolle über erlaubte Clients zu haben.</li>
<li><strong>Authorization URL:</strong> Als Client-Entwickler möchte ich eine Authorization URL zur Verfügung haben, um Authorization Codes anfordern zu können.</li>
<li><strong>Access Token URL:</strong> Als Client-Entwickler möchte ich eine Access Token URL zur Verfügung haben, um Access Tokens anfordern zu können.</li>
<li><strong>Verwaltung autorisierter Applikationen</strong>: Als ownCloud-Nutzer möchte ich in den persönlichen Einstellungen autorisierte Applikationen verwalten können, um einen Überblick zu haben und Autorisierungen widerrufen zu können.</li>
</ul>
<h4 id="datenmodell">Datenmodell</h4>
<p>Zunächst musste ein Datenmodell zur Speicherung der benötigten Daten aufgestellt werden. Gemäß dem Authorization Code Flow wurden folgende Entitäten mit Attributen definiert:</p>
<ul>
<li><strong><a href="https://tools.ietf.org/html/rfc6749#section-1.1"><code>client</code></a>:</strong> Die Applikation, die für den Zugriff auf die WebDAV Schnittstelle autorisiert werden soll.<ul>
<li><code>identifier</code>: Zeichenkette, die einen Client eindeutig identifiziert.</li>
<li><code>secret</code>: Zeichenkette, mit der ein Client sich beim Anfordern eines Access Tokens authentifizieren kann.</li>
<li><code>redirect_uri</code>: URI, an die nach erfolgter Autorisierung des Nutzers weitergeleitet wird.</li>
</ul>
</li>
<li><strong><a href="https://tools.ietf.org/html/rfc6749#section-1.3.1"><code>authorization_code</code></a>:</strong> Ein <a href="https://tools.ietf.org/html/rfc6749#section-1.3">Authorization Grant</a>, mit dem der Client die Autorisierung des Nutzers darlegen und somit ein Access Token anfordern kann.<ul>
<li><code>code</code>: Zeichenkette, die als Authorization Code dient.</li>
<li><code>client_id</code>: Client Identifier des Clients, für den der Authorization Code ausgegeben wird.</li>
<li><code>user_id</code>: User ID des ownCloud-Nutzers, der den Client autorisiert hat.</li>
<li><code>expires</code>: Zeitpunkt, zu dem der Authorization Code ungültig wird (optional).</li>
</ul>
</li>
<li><strong><a href="https://tools.ietf.org/html/rfc6749#section-1.4"><code>access_token</code></a>:</strong> Eine Zeichenkette, die den Zugriff auf die WebDAV Schnittstelle erlaubt.<ul>
<li><code>code</code>: Zeichenkette, die als Access Token dient.</li>
<li><code>client_id</code>: Client Identifier des Clients, für den der Access Token ausgegeben wird.</li>
<li><code>user_id</code>: User ID des ownCloud-Nutzers, der den Client autorisiert hat.</li>
<li><code>expires</code>: Zeitpunkt, zu dem der Access Token ungültig wird (optional).</li>
</ul>
</li>
<li><strong><a href="https://tools.ietf.org/html/rfc6749#section-1.5"><code>refresh_token</code></a>:</strong> Eine Zeichenkette, mit der ein abgelaufener Access Token gegen einen neuen ausgetauscht werden kann.<ul>
<li><code>code</code>: Zeichenkette, die als Refresh Token dient.</li>
<li><code>client_id</code>: Client Identifier des Clients, für den der Access Token ausgegeben wird.</li>
<li><code>user_id</code>: User ID des ownCloud-Nutzers, der den Client autorisiert hat.</li>
<li><code>expires</code>: Zeitpunkt, zu dem der Refresh Token ungültig wird (optional).</li>
</ul>
</li>
</ul>
<p>Folgendes Entity-Relationship-Modell fasst das Datenmodell nochmal grafisch zusammen.</p>
<h3 id="anpassung-der-dav-app">Anpassung der <code>dav</code> App</h3>
<h2 id="benutzung">Benutzung</h2>
<h3 id="installation">Installation</h3>
<p>Da die Änderungen zum aktuellen Zeitpunkt noch nicht in den Core aufgenommen wurden, muss der <code>dav-oauth</code>-Branch des <a href="https://github.com/pssl16/core">geforkten Repositorys</a> geklont werden:</p>
<pre><code class="nohighlight">$ git clone -b dav-oauth https://github.com/pssl16/core</code></pre>

<p>Danach müssen die Dependencies installiert werden. Dazu genügt es, im Verzeichnis des Repositorys folgenden Befehl auszuführen:</p>
<pre><code class="nohighlight">$ make</code></pre>

<p>Die restlichen Installationsschritte unterscheiden sich nicht von denen im <a href="https://doc.owncloud.org/server/latest/admin_manual/installation/index.html">ownCloud Handbuch</a>.</p>
<h3 id="clientregistrierung">Clientregistrierung</h3>
<h3 id="authorization-code-flow">Authorization Code Flow</h3>
<p>Die nachfolgende Abbildung stellt den durch die <code>oauth2</code> App implementierten <a href="https://tools.ietf.org/html/rfc6749#section-4.1">OAuth 2.0 Authorization Code Flow</a> dar.</p>
<p><img alt="Authorization Code Flow" src="../images/authorization-code-flow.svg" /></p>
<div class="alert alert-danger">
  <strong>TODO:</strong> Beschreibung der Schritte einfügen.
</div>

<h3 id="angepasste-webdav-schnittstelle">Angepasste WebDAV Schnittstelle</h3></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Copyright &copy; 2016 PSSL16<br></small>
        
        <small>Dokumentation erzeugt mit <a href="http://www.mkdocs.org/">MkDocs</a>.</small></p>
    </footer>

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Schließen</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Suchen</h4>
                </div>
                <div class="modal-body">
                    <p>
                        Hier können Sie die Dokumentation durchsuchen. Geben Sie Ihre Suchbegriffe unten ein.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Suchen..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
